---
title: "Simulation von Zufallszahlen"
subtitle: "Vorlesung: Computerintensive Methoden SS 2017"
author: 
- "Bernhard Preisler (734631)"
- "[Hendrik Pfaff](http://hendrik-pfaff.de) (725837)"
date: "`r format(Sys.time(), '%d.%m.%Y')`"
tags: [Vorlesung, Computational Statistics, Zufallszahlen, Zufallsvariablen, Simulation]
output:
  pdf_document:
    toc: true
---

\newpage
# Motiviation
Zufallszahlen spielen eine wichtige Rolle in Wissenschaft, Technik und Industrie. Sie werden beispielsweise in der Kryptographie bei der Wahl eines Schlüssels, bei Computersimulationen zur Erzeugung von unvorhergesehenen Ereingissen oder in der statistischen Analyse bei der Auswahl von Stichproben benutzt.  
Die Erzeugung von Zufälligkeiten in einem Computer (ein deterministischer Automat) stellt allerdings eine besondere Herausforderung dar, da jede Operation durch die Vorherige definiert wird und daher (theoretisch) berechenbar ist.

# Definitionen
Um möglichen Verwirrungen vorzubeugen, werden in diesen Kapitel Begrifflichkeiten in Bezug aus das Thema Simulation von Zufallszahlen eingeführt und abgegrenzt.

## Simulation

## Zufallsvariablen \& Zufallszahlen
Eine \textbf{Zufallsvariable} ist eine Variable, die die Wahrscheinlichkeit eines noch nicht durchgeführten Experiments beschreibt. Beispielsweise kann solch eine Zufallsvariable den Wurf eines fairen sechseitigen Würfels beschreiben. Die Wahrscheinlichkeit für den Ausgang eines bestimmten Ergebnis ist in diesem Beispiel gleichverteilt. Das Ergebnis wird als \textbf{Zufallszahl} beschrieben. Mathematisch wird eine Zufallsvariable mit einem Großbuchstaben $X$, $Y$, $Z$ und eine Zufallszahl mit einen Kleinbuchstaben $x$ betitelt.

## Nichtdeterministische \& deterministische Zufallsgeneratoren
Das Ergebnis eines Algorithmus verändert sich bei gleichbleibenden Eingaben nicht. Demnach lässt sich eine komplett zufällige Funktion rein durch Software nicht realisieren. Eine Möglichkeit dieses Problem zu lösen ist es bestimmte physikalische Prinzipien miteinzubeziehen. Durch deren gegebene Zufälligkeit lassen sich Funktionen erstellen, die zu ebenso zufälligen Ergebnissen führen. Dieses Prinzip nennt sich \emph{Nichtdeterminismus} und diese Art von Generatoren werden die \textbf{nichtdeterministische Zufallsgenerator} genannt.\newline

Hierzu wird oft Hardware verwendet, die durch Sensoren physikalische Effekte messen kann. Unter anderem: 

* Radioaktiver Zerfall
* Wärmerauschen
* zufällige quantenmechanische Vorgänge
* Atmosphärenrauschen (wie analoges Radio, das nicht auf einen Sender abgestimmt ist)

\begin{figure}[ht]
	\centering
  \includegraphics[width=100px, height=100px]{img/FST-01_board.png}
	\caption {Der Flying Stone Technology FST-01 erzeugt echte Zufallszahlen aus dem Rauschen bei der Analog-Digital Signalumwandlung.}
	\label{fig2}
\end{figure}

Allerdings müssen physikalische Beobachtunge (um die Zahlen zu generieren) in einem angemessen großen Abstand zueinander erfolgen um Unabhängigkeit zu gewährleisten

Demnach zeichnen sich die \textbf{deterministischen Zufallsgeneratoren} dadurch aus, dass bei gleicher Eingabe immer der selber Ausgang berechnet wird. Die so erzeugten Zahlen werden \textbf{Pseudozufallszahlen} genannt.

# Erzeugen von (Pseudo)Zufallszahlen

Bevor mit dem Bau eines deterministischer Zufallsgenerators begonnen wird, stellt sich die Frage, welches Ziel ein solcher Zufallsgenerator erfüllen soll. Umgangsprachlich kann ein Ziel für die Simulation von Zufallszahlen auf einen Rechner folglich definiert werden:

> \textbf{"... ein auf einem Rechner ablauffähiges Zufallsexperiment zu erhalten, ..."}, Michael Kolonk

Weiterhin besteht die Möglichkeit die Definition auf einer mathemathischen Ebene zu heben.

> Eine Folge von iid. Zufallsvariablen $(X_n)_{n\geq0}$ mit $U(0,1)$, Michael Kolonk

## Generatoren für gleichverteilte Zufallszahlen



### Mittquadratverfahren
Das \textbf{Mittquadratverfahren (engl.: Middle-Square method)} ist ein einfacher Algorithmus zur Erzeugung gleichverteilter (Pseudo)Zufallszahlen.  Er wurde 1946 von John von Neumann entwickelt. 

* Problem beim Auftauchen der Null
* Häufige Wiederholungen
* Verwendung als Hash-Funktion
* siehe: Shiny app

### Sonstige

## Generatoren für sonstige Verteilungen
Für den Fall, dass 

### Inversionsmethode
Mit Hilfe der \textbf{Inversionsmethode (engl.: Inverse transform sampling)} lassen sich (fast) beliebige diskrete und stetige Wahrscheinlichkeitsverteilungen aus gleichverteilten Zufallszahlen erzeugen. Diesem Generator liegt das \textbf{Simulationslemma} zugrunde, das besagt, dass 


\emph{Stetige Verteilungen}

\emph{Diskrete Verteilungen}


\emph{Beispiel:} Simulation der Exponentialverteilung $exp(\alpha)$

Die Exponentialverteilung ist mit der Verteilungsfunktion $$F(t)=1-e^{-\lambda e}$$ mit $t>0$ definiert.
Bilden wir nun die Umkehrfunktion, erhalten wir $$x=F^{-1}(y)=-\frac{1}{\lambda}ln(1-y)$$. 

```{r, echo=false}
# Plot der exponentialfunktions
```

Auch wenn sich so theoretisch alle Verteilungen simulieren lassen, scheitert diese Methode in der Praxis daran, dass sich deren Quantilfunktion (z.B. bei Normalverteilung) nicht effizient berechnen lässt.

### Sonstige Methoden
Neben den Vorgestellten Methoden, gibt es noch eine ganze Reihe weitere Generatoren für speziell verteilte Zufallszahlen.

* \textbf{Verwerfungsmethode (engl.: Rejection sampling)}: Alternative zur Inversionsmethode, für Wahrscheinlichkeitsverteilungen, die zu komplex zu berechnen sind.

* \textbf{Kompositionsmethode}: 

# Güte eines Zufallszahlengenerators
Stell dir vor, du hast eben einen Zufallsgenerator kreiert und möchtest wissen, wie dieser im Gegensatz zu den bereits bestehenden Generatoren performt. Du möchstest demnach die Güte (Qualität) deines Zufallsgenerators beurteilen können. Michael Kolonk unterteilt dieses große Gebiet in die zwei Kriterien das \textbf{analytische Gütekriterium} und das \textbf{statistische Gütekriterium}.

## Analytische Gütekriterien
Im Gegensatz zu den statistischen Gütekriterium macht das \textbf{analytische Gütekriterium} über spezielle Zufallzahlengeneratoren starke Aussagen über die Güte. Jedoch bringt dies das Problem mit sich, dass diese Aussagen nur über diesen speziellen Generator gelten und daher für den Vergleich mit weiteren Generatoren nicht ideal ist. In diesem Fall wird versucht die Güte anhand eines Modells im Vergleich zum Zufallsexperiment anzunähern und mit vergleichbaren Eigenschaften wird versucht die Güte zu überprüfen.

Einer dieser vergleichbaren Eigenschaften kann die Überprüfung auf die Gleichverteilung sein. Dabei wird die Verteilung $X_0,...,X{d-1}$ für alle $d \ge 1$ mit der Gleichverteilung $[0,1]^d$ verglichen und sollte bestmöglich über ein stimmen. Sei $(X_n){n\ge0}$ eine Folge von Zufallsvariablen mit den Werten in $[0,1]$. $(X_n){n\ge0}$ ist i.i.d mit der Verteilung $U(0,1)$, falls fir alle $d \in \mathbb{N}$ und alle $0 \le a_i \le b_i \le 1, i = 0,...,d-1$, gilt

$$ P(a_i < X_i \le b_i, i = 0,...,d-1) = \prod_{i=0}^{d-1}(b_i-a_i)$$
Dabei unterscheiden sich die Untersuchungen in die zwei grundsätzlich Gebiete empirisch und analytisch. Die \textbf{empirische Unterschung} nimmt ein bestehendes mathemathisches Modell an und überprüft, ob die beobachteten Ereignisse von Zufallszahlen mit den mathematischen Modell zusammen passt. Dabei besteht die Möglichkeit diese Untersuchung graphisch oder statistisch durchzuführen. Folgende Einschrunkungen muss die die empirischen Untersuchung hinnehmen.

* Es besteht nur die Möglichkeit endlich viele Bedingungen zu überprüfen 
* Die obere Foderung ist zu stark und kann nur approximiert werden
<!-- Hier gibt es noch eine weitere Einschränkung -->

Die \textbf{analytische Untersuchung} versucht die Gütes des Zufallsgenerators anhand mathematischer-analystischer Methoden nachzuweisen.

### d-gleichverteilte Folgen
Wie im vorigen Kapitel angesprochen, kann nur eine endliche Zahlenfolge $(x_n)_{n \ge 0}$ mit einer Länge $d$ überprüft werden kann. Sollte die Beobachtung wiederholt werden und unabhängig sein, sollten die Teilstücke disjunkt gewählt werden. 

Weiterhin existiert die Möglichkeit, dass die Zahlenfolgen sich schneiden können. $\tilde{x}_i$ ist für  in der Form

$$\tilde{x}_i := (x_{ik}, x_{ik+1},...,x_{ik+d-1}),\quad i = 0,1,...$$
überlappend. Wenn

* $1 \le k \le d - 1$ für $\tilde{x}_i$ gilt,  die Teilstücke überlappend, wenn
* $k = d$ gilt, sind die Teilstücke disjunkt und lückenlos sind, wenn
* $k > d$ gilt, sind die Teilstücke disjunkt und gespreizt sind. 

### Graphische Überprüfung der Gleichverteilung
Jetzt gilt die vorgeschlagenen Bedingungen anhand von graphischen Mitteln zu untersuchen. Als Beispiel wurde der Mersenne-Twister, Super-Duper und PP-Coincidence ausgewählt. Alle ausgewählten Verfahren sollten nach Möglichkeit gleichverteilt nach der Verteilung $U(0,1)$ erfüllen. 

Der \textbf{Mersenne-Twister} arbeitet mit einer Periodenlänge von $p = 2^{19937} - 1$. Wie der Name schon sagt, ist das eine Mersenne-Prinzahl. Der Pseudozufallszahlengenerator \textbf{Super-Duper} wurde in den 70ger Jahren erfunden und arbeitet mit einer Periodenlänge von $p = 6*10^{18}$. Als dritten Generator wurde der \textbf{Wichmann-Hill} verwendet. Er generiert Zufallszahlen mit einer Periodenlänge von mehr als $6.95 * 10^{12}$.

Unterteilt werden die Zufallszahlenergebnisse jedes Verfahren in $2^5$ gleich große Teilintervalle $I_0,...,I_{31}$. Durch die Unterteilung besteht die Möglichkeit die Anzahl der Vorkommnisse in jeden Teilintervall mit der Formel
$$h_i := \displaystyle\sum_{n=0}^{N-1} 1_{I_i}(u_n)$$
zu berechnen. Die relativen Häufigkeiten können für jedes Intervall mit $\dfrac{h_i}{N}$ bestimmt werden.

```{r, echo=FALSE}
library(ggplot2)
numberOfRandomNumbers <- 100000

RNGkind("Mersenne-Twister") # matches  "Mersenne-Twister"
datamt = data.frame(data = runif(numberOfRandomNumbers), KindOfRandom = "Mersenne-Twister")

RNGkind("Super") # matches  "Super-Duper"
datasd = data.frame(data = runif(numberOfRandomNumbers), KindOfRandom = "Super-Duper")

RNGkind("Wichmann-Hill") # matches  "Wichmann-Hill"
datawh = data.frame(data = runif(numberOfRandomNumbers), KindOfRandom = "Wichmann-Hill")

data <- rbind(datamt, datasd, datawh)

ggplot(data, aes(x = data, color = KindOfRandom, fill = KindOfRandom)) + 
  geom_histogram(bins = 32) + 
  facet_grid(~ KindOfRandom) +
  theme(legend.direction = "horizontal", 
        legend.position = "bottom",
        legend.box = "horizontal") +
  labs(title = "Unterschiedliche Zufallszahlengeneratoren pro Histogramm (Verteilung)",
  x = "Generierte Zufallszahlen (32er Bins)",
  y = "Anzahl der Zufallszahlen pro Bin")
```

## Statistische Gütekriterien



# Zufallszahlen in R
* Die Statistik-software R enthält mehrere Generatoren für Zufallszahlen
* R's random number generator.
* Setzen von Seeds
```{r}
#?RNG
```
* Verschiedene Methoden zur Auswahl
    + Wichmann-Hill
    + Marsaglia-Multicarry
    + Super-Duper
    + Marsenne-Twister
    + Knuth-TAOCP-2002
    + Knuth-TAOCP
    + L'Ecuyer-CMRG
    + Eigene

## Setzen eines Seeds (optional)
```{r}
```

## Auswahl der RNG in R

```{r}
# insert random R-code
# 
```

## Eigene RNG
### PP-Coincidence
```{r, echo=FALSE}
#options(expressions=100000)
# Berechnet die neue Zufallszahl
#PP.Coincidence.CalculateNumber <- function (randomNumber) {
#  first <- as.numeric(substr(randomNumber, 0, 5))
#  second <- as.numeric(substr(randomNumber, 6, 10))
#  
#  if(is.na(second) || second == 0) {
#    second <- bitwXor(first, as.numeric(substr(as.numeric(Sys.time()), 6, 10)))
#  }
#  return (first * second)
#}

# Rekursiver Aufrauf
#PP.Coincidence.Recursive <- function(numberOfRandomNumbers, randomNumber, randomList) {
#  if (numberOfRandomNumbers <=0 ) {
#    return( c() )
#  } else {
#    newRN <- PP.Coincidence.CalculateNumber(randomNumber)
#    return( c(Recall(numberOfRandomNumbers-1, newRN, randomList),newRN/10000000000) )
#  }
#}

# Initialaufruf mit einer Anzahl von Zufallszahlen
#PP.Coincidence <- function(numberOfRandomNumbers){
#  return (PP.Coincidence.Recursive(numberOfRandomNumbers, as.numeric(Sys.time()), c()))
#}
```
## Prüfung auf Unabhängigkeit der Zufallszahlen


# Quellen

[1] [J.E._Gentle,_Wolfgang_HSrdle,_James_E._Gentle

[2] Severin Schürz http://www.fim.uni-linz.ac.at/Lva/Web_Security/Abgaben/Schuerz-RNG.pdf

[3] Stochastische Simulation



